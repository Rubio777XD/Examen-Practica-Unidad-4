{% extends "base.html" %}
{% block content %}
<section class="form-page">
  <h1>Login (solo demo)</h1>
  <div class="card card-glass">
    <form id="loginForm">
      <label>Email
        <input name="email" type="email" required>
      </label>
      <button type="submit" class="btn btn-primary">Iniciar sesión</button>
    </form>
  </div>
  <button id="logoutBtn" type="button" class="btn btn-ghost">Cerrar sesión</button>
</section>
<script>
const loginForm = document.getElementById('loginForm');
if (loginForm) {
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const { email } = Object.fromEntries(new FormData(loginForm).entries());
    try {
      const users = await api('/api/users');
      const user = users.find((u) => u.email.toLowerCase() === email.toLowerCase());
      if (user) {
        localStorage.setItem('demo_user', JSON.stringify(user));
        showMessage('Login demo correcto', 'success');
        window.location.href = '/users';
      } else {
        showMessage('No existe un usuario con ese email', 'error');
      }
    } catch (err) {
      showMessage(errorMessageFrom(err), 'error');
    }
  });
}

const logoutBtn = document.getElementById('logoutBtn');
if (logoutBtn) {
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('demo_user');
    showMessage('Sesión demo cerrada', 'info');
  });
}
</script>
{% endblock %}
